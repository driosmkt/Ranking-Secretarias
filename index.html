<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Aut√¥nomo com Hist√≥rico - Corrida Digital</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root { --cor-fundo: #0f1018; --cor-card: #1c1d2b; --cor-card-secundario: #212232; --cor-texto-principal: #ffffff; --cor-texto-secundario: #a7a7a7; --cor-amarelo: #f9c74f; --cor-azul: #4a90e2; --cor-vermelho: #e74c3c; }
        body { background-color: var(--cor-fundo); color: var(--cor-texto-principal); font-family: 'Poppins', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        #logo-principal { display: block; margin: 20px auto 30px auto; max-width: 450px; width: 90%; }
        
        h2, h3 { text-align: center; }
        h2 { font-size: 1.8em; }
        .update-container { background-color: var(--cor-card); border-radius: 10px; padding: 25px; margin-top: 30px; width: 100%; max-width: 800px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); }
        .update-container h3 { margin-top: 0; color: var(--cor-amarelo); }
        #update-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; align-items: flex-end; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; font-size: 0.9em; color: var(--cor-texto-secundario); }
        .form-group select, .form-group input { background-color: var(--cor-card-secundario); color: var(--cor-texto-principal); border: 1px solid #444; border-radius: 5px; padding: 10px; font-family: 'Poppins', sans-serif; font-size: 1em; }
        #update-button { background-color: var(--cor-azul); color: var(--cor-texto-principal); border: none; border-radius: 5px; padding: 12px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; height: 45px; }
        #update-button:hover { background-color: #357abd; }
        #reset-button { background-color: transparent; border: 1px solid var(--cor-vermelho); color: var(--cor-vermelho); transition: background-color 0.3s, color 0.3s; padding: 12px; font-weight: 600; cursor: pointer; height: 45px; border-radius: 5px; }
        #reset-button:hover { background-color: var(--cor-vermelho); color: var(--cor-texto-principal); }
        .podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 20px; flex-wrap: wrap; width: 100%; max-width: 1200px; margin-top: 40px; min-height: 300px; }
        .podium-card { background-color: var(--cor-card); border: 2px solid transparent; border-radius: 10px; padding: 25px; text-align: center; width: 280px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, border-color 0.3s ease; }
        .podium-card:hover { transform: translateY(-10px); }
        .podium-card h3 { margin: 0; font-size: 1.2em; color: var(--cor-texto-principal); height: 40px; }
        .podium-card .posicao { font-size: 3em; font-weight: 700; }
        .podium-card-1 { order: 2; height: 280px; border-color: #ffd700; }
        .podium-card-2 { order: 1; height: 250px; border-color: #c0c0c0; }
        .podium-card-3 { order: 3; height: 250px; border-color: #cd7f32; }
        .podium-card-1 .posicao { color: #ffd700; }
        .podium-card-2 .posicao { color: #c0c0c0; }
        .podium-card-3 .posicao { color: #cd7f32; }
        .podium-data { margin-top: 20px; text-align: left; font-size: 0.9em; }
        .podium-data p { display: flex; justify-content: space-between; margin: 10px 0; }
        .podium-data span { font-weight: 600; }
        .ranking-container { width: 100%; max-width: 1000px; margin-top: 50px; }
        .ranking-table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: var(--cor-card); border-radius: 10px; overflow: hidden; }
        .ranking-table th, .ranking-table td { padding: 15px; text-align: left; }
        .ranking-table thead { background-color: #2a2c3d; color: var(--cor-amarelo); font-weight: 600; }
        .ranking-table tbody tr { border-bottom: 1px solid #2a2c3d; }
        .ranking-table tbody tr:last-child { border-bottom: none; }
        .ranking-table tbody tr:nth-child(even) { background-color: var(--cor-card-secundario); }
        .ranking-table .pos-cell { font-weight: 700; color: var(--cor-amarelo); text-align: center; }
        
        /* --- NOVO AVISO --- */
        .warning-box {
            background-color: rgba(249, 199, 79, 0.1);
            color: var(--cor-amarelo);
            border: 1px solid var(--cor-amarelo);
            padding: 12px;
            border-radius: 5px;
            text-align: center;
            margin: 10px 0 25px 0;
            font-weight: 500;
        }

        /* --- NOVO RODAP√â --- */
        .footer { width: 100%; padding: 40px 20px; text-align: center; margin-top: 60px; border-top: 1px solid #2a2c3d; }
        .footer-title { font-size: 1.2em; font-weight: 600; color: var(--cor-texto-principal); margin: 0; }
        .status-indicator { display: flex; align-items: center; justify-content: center; margin: 20px 0; gap: 10px; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background-color: var(--cor-amarelo); animation: pulse 2s infinite; }
        .status-text { font-weight: 600; letter-spacing: 1px; color: var(--cor-amarelo); }
        .footer-copyright { font-size: 0.9em; color: var(--cor-texto-secundario); margin: 0; }
        #print-button { background-color: #2a2c3d; color: var(--cor-texto-principal); border: 1px solid var(--cor-texto-secundario); border-radius: 5px; padding: 10px 20px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; margin-top: 20px; }
        #print-button:hover { background-color: #3c3e52; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(249, 199, 79, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(249, 199, 79, 0); } 100% { box-shadow: 0 0 0 0 rgba(249, 199, 79, 0); } }

        /* --- ESTILOS PARA IMPRESS√ÉO --- */
        @media print {
            body { background-color: #ffffff; color: #000000; padding: 0; margin: 20px; }
            header, .update-container, .footer, h2:not(.ranking-container h2) { display: none !important; }
            main { margin-top: 0; }
            .ranking-container { margin-top: 30px; }
            .podium-container { min-height: auto; }
            .podium-card, .ranking-table { border: 1px solid #ccc; box-shadow: none; }
            .podium-card h3, .podium-data span, .ranking-table .pos-cell { color: #000 !important; }
            .podium-card-1 { border-color: #a5a5a5; }
            .podium-card-2 { border-color: #cccccc; }
            .podium-card-3 { border-color: #e0e0e0; }
        }
    </style>
</head>
<body>
    <header>
        <img id="logo-principal" src="Logo-1.png" alt="Logo Sim√£o na Rede Digital">
    </header>

    <section class="update-container">
        <h3>√Årea de Atualiza√ß√£o de Dados</h3>
        <div class="warning-box">‚ö†Ô∏è Ap√≥s atualizar os dados, salve em PDF.</div>
        <form id="update-form" onsubmit="return false;">
            <div class="form-group" style="grid-column: 1 / -1;">
                <label for="secretaria-select">Selecione a Secretaria</label>
                <select id="secretaria-select"></select>
            </div>
            <div class="form-group">
                <label for="cadastros-input">Cadastros</label>
                <input type="number" id="cadastros-input" min="0" required>
            </div>
            <div class="form-group">
                <label for="cliques-input">Cliques</label>
                <input type="number" id="cliques-input" min="0" required>
            </div>
            <div class="form-group">
                <label for="membros-input">Membros</label>
                <input type="number" id="membros-input" min="0" required>
            </div>
            <button type="submit" id="update-button">Atualizar Ranking</button>
            <button type="button" id="reset-button">Restaurar Originais</button>
        </form>
    </section>

    <main>
        <section class="podium-section">
            <h2>üèÜ P√≥dio das Secretarias üèÜ</h2>
            <div id="podium-container" class="podium-container"></div>
        </section>

        <section class="ranking-container">
            <h2>Ranking Geral</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th style="width: 10%; text-align: center;">Pos.</th>
                        <th style="width: 50%;">Secretaria</th>
                        <th style="width: 15%;">Cadastros</th>
                        <th style="width: 15%;">Cliques</th>
                        <th style="width: 15%;">Membros</th>
                    </tr>
                </thead>
                <tbody id="ranking-body"></tbody>
            </table>
        </section>

        <section class="ranking-container">
            <h2>Hist√≥rico de Atualiza√ß√µes</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th style="width: 25%;">Data e Hora</th>
                        <th style="width: 35%;">Secretaria</th>
                        <th style="width: 40%;">Novos Dados</th>
                    </tr>
                </thead>
                <tbody id="historico-body"></tbody>
            </table>
        </section>
    </main>
    
    <footer class="footer">
        <p class="footer-title">N√∫cleo Digital da Secretaria de Comunica√ß√£o</p>
        <div class="status-indicator">
            <span class="status-dot"></span>
            <span class="status-text">CONECTADO</span>
        </div>
        <p class="footer-copyright">¬© 2025 Prefeitura de Petrolina ‚Äì Secretaria de Comunica√ß√£o</p>
        <button type="button" id="print-button">Salvar em PDF</button>
    </footer>

    <script>
        const DATA_KEY = 'dashboard_data_secretarias_v2'; // Nova chave para evitar conflito com dados antigos
        const HISTORICO_KEY = 'dashboard_historico_secretarias_v2';

        const initialData = [
            { nome: "Sa√∫de", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Educa√ß√£o, Cultura e Esporte", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Desenvolvimento Econ√¥mico, Turismo e Inova√ß√£o", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Infraestrutura e Mobilidade", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Assist√™ncia Social e Combate √† Fome", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Comunica√ß√£o", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Desenvolvimento Rural", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Servi√ßos P√∫blicos e Defesa Civil", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Governo", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Desenvolvimento Urbano, Habita√ß√£o e Sustentabilidade", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Casa Civil", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Planejamento, Gest√£o e Finan√ßas", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Seguran√ßa P√∫blica", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Ammpla", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Licita√ß√µes e Contratos", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Receitas Municipais", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Autarquia 1", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Autarquia 2", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Procuradoria-Geral do Munic√≠pio", cadastros: 0, cliques: 0, membros: 0 }, { nome: "Controladoria-Geral do Munic√≠pio", cadastros: 0, cliques: 0, membros: 0 }
        ];

        let dadosSecretarias = [];
        let historico = [];

        const form = document.getElementById('update-form');
        const select = document.getElementById('secretaria-select');
        const cadastrosInput = document.getElementById('cadastros-input');
        const cliquesInput = document.getElementById('cliques-input');
        const membrosInput = document.getElementById('membros-input');
        const resetButton = document.getElementById('reset-button');
        const podiumContainer = document.getElementById('podium-container');
        const rankingBody = document.getElementById('ranking-body');
        const historicoBody = document.getElementById('historico-body');
        const printButton = document.getElementById('print-button');

        function saveData() { localStorage.setItem(DATA_KEY, JSON.stringify(dadosSecretarias)); localStorage.setItem(HISTORICO_KEY, JSON.stringify(historico)); }
        function loadData() { const savedData = localStorage.getItem(DATA_KEY); const savedHistorico = localStorage.getItem(HISTORICO_KEY); dadosSecretarias = savedData ? JSON.parse(savedData) : initialData; historico = savedHistorico ? JSON.parse(savedHistorico) : []; }
        function sortAndRank() { dadosSecretarias.sort((a, b) => { if (b.cadastros !== a.cadastros) return b.cadastros - a.cadastros; if (b.cliques !== a.cliques) return b.cliques - a.cliques; return b.membros - a.membros; }); }
        function renderPodium() { podiumContainer.innerHTML = ''; const top3 = dadosSecretarias.slice(0, 3); top3.forEach((secretaria, index) => { const card = document.createElement('div'); card.className = `podium-card podium-card-${index + 1}`; card.innerHTML = `<span class="posicao">${index + 1}¬∫</span><h3>${secretaria.nome}</h3><div class="podium-data"><p>Cadastros: <span>${secretaria.cadastros}</span></p><p>Cliques: <span>${secretaria.cliques}</span></p><p>Membros: <span>${secretaria.membros}</span></p></div>`; podiumContainer.appendChild(card); }); }
        function renderRankingTable() { rankingBody.innerHTML = ''; const restoDoRanking = dadosSecretarias.slice(3); restoDoRanking.forEach((secretaria, index) => { const posicao = index + 4; const linha = document.createElement('tr'); linha.innerHTML = `<td class="pos-cell">${posicao}¬∫</td><td>${secretaria.nome}</td><td>${secretaria.cadastros}</td><td>${secretaria.cliques}</td><td>${secretaria.membros}</td>`; rankingBody.appendChild(linha); }); }
        function renderHistorico() { historicoBody.innerHTML = ''; const logEntries = [...historico].reverse().slice(0, 20); logEntries.forEach(entry => { const dataFormatada = new Date(entry.timestamp).toLocaleString('pt-BR'); const novosDados = `Cad: ${entry.cadastros}, Cliques: ${entry.cliques}, Membros: ${entry.membros}`; const linha = document.createElement('tr'); linha.innerHTML = `<td>${dataFormatada}</td><td>${entry.nome}</td><td>${novosDados}</td>`; historicoBody.appendChild(linha); }); }
        function updateAllDisplays() { sortAndRank(); renderPodium(); renderRankingTable(); renderHistorico(); }
        function populateSelect() { const sortedByName = [...dadosSecretarias].sort((a, b) => a.nome.localeCompare(b.nome)); select.innerHTML = ''; sortedByName.forEach(secretaria => { const option = document.createElement('option'); option.value = secretaria.nome; option.textContent = secretaria.nome; select.appendChild(option); }); }
        function fillFormWithSelectedData() { const selectedName = select.value; const secretariaData = dadosSecretarias.find(s => s.nome === selectedName); if (secretariaData) { cadastrosInput.value = secretariaData.cadastros; cliquesInput.value = secretariaData.cliques; membrosInput.value = secretariaData.membros; } }
        function handleFormSubmit(event) {
            event.preventDefault();
            const selectedName = select.value;
            const novosDados = { cadastros: parseInt(cadastrosInput.value) || 0, cliques: parseInt(cliquesInput.value) || 0, membros: parseInt(membrosInput.value) || 0 };
            const logEntry = { timestamp: new Date().toISOString(), nome: selectedName, ...novosDados };
            historico.push(logEntry);
            const secretariaIndex = dadosSecretarias.findIndex(s => s.nome === selectedName);
            if (secretariaIndex > -1) { dadosSecretarias[secretariaIndex] = { ...dadosSecretarias[secretariaIndex], ...novosDados }; }
            saveData();
            updateAllDisplays();
            alert(`Dados da secretaria "${selectedName}" foram atualizados e salvos no seu navegador!`);
        }
        function handleReset() { if (confirm('Tem certeza de que deseja apagar todos os dados salvos e restaurar os valores originais?')) { localStorage.removeItem(DATA_KEY); localStorage.removeItem(HISTORICO_KEY); location.reload(); } }

        window.onload = () => {
            loadData();
            updateAllDisplays();
            populateSelect();
            fillFormWithSelectedData();
            form.addEventListener('submit', handleFormSubmit);
            resetButton.addEventListener('click', handleReset);
            select.addEventListener('change', fillFormWithSelectedData);
            printButton.addEventListener('click', () => { window.print(); });
        };
    </script>
</body>
</html>
